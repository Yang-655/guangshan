<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¼©ç•¥å›¾ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .thumbnail-preview {
            max-width: 200px;
            max-height: 150px;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ–¼ï¸ ç¼©ç•¥å›¾ä¿®å¤åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•è¯´æ˜</h2>
        <div class="info test-result">
            <strong>ä¿®å¤å†…å®¹ï¼š</strong><br>
            1. âœ… åœ¨publishVideoæ–¹æ³•ä¸­æ·»åŠ ç¼©ç•¥å›¾ä¿å­˜é€»è¾‘<br>
            2. âœ… åç«¯APIæ”¯æŒthumbnail_urlå­—æ®µ<br>
            3. âœ… Profileé¡µé¢ä¼˜å…ˆä½¿ç”¨æ•°æ®åº“ä¸­çš„ç¼©ç•¥å›¾<br>
            4. ğŸ§ª æµ‹è¯•å®Œæ•´æµç¨‹ï¼šç¼–è¾‘å™¨ç”Ÿæˆç¼©ç•¥å›¾ â†’ å‘å¸ƒä¿å­˜ â†’ Profileé¡µé¢æ˜¾ç¤º
        </div>
    </div>

    <div class="test-section">
        <h2>1. æ¨¡æ‹Ÿç¼–è¾‘å™¨ç”Ÿæˆç¼©ç•¥å›¾</h2>
        <button onclick="simulateEditorThumbnail()">ç”Ÿæˆæ¨¡æ‹Ÿç¼©ç•¥å›¾</button>
        <div id="editor-result"></div>
    </div>

    <div class="test-section">
        <h2>2. æ¨¡æ‹Ÿè§†é¢‘å‘å¸ƒæµç¨‹</h2>
        <button onclick="simulateVideoPublish()">æ¨¡æ‹Ÿå‘å¸ƒè§†é¢‘</button>
        <div id="publish-result"></div>
    </div>

    <div class="test-section">
        <h2>3. æ¨¡æ‹ŸProfileé¡µé¢åŠ è½½</h2>
        <button onclick="simulateProfileLoad()">æ¨¡æ‹ŸProfileåŠ è½½</button>
        <div id="profile-result"></div>
    </div>

    <div class="test-section">
        <h2>4. å®Œæ•´æµç¨‹æµ‹è¯•</h2>
        <button onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <div id="full-test-result"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç¼–è¾‘å™¨ç”Ÿæˆç¼©ç•¥å›¾
        function simulateEditorThumbnail() {
            const resultDiv = document.getElementById('editor-result');
            resultDiv.innerHTML = '<div class="info test-result">æ­£åœ¨ç”Ÿæˆæ¨¡æ‹Ÿç¼©ç•¥å›¾...</div>';
            
            // åˆ›å»ºä¸€ä¸ªç®€å•çš„canvasç¼©ç•¥å›¾
            const canvas = document.createElement('canvas');
            canvas.width = 320;
            canvas.height = 240;
            const ctx = canvas.getContext('2d');
            
            // ç»˜åˆ¶æ¨¡æ‹Ÿè§†é¢‘å¸§
            const gradient = ctx.createLinearGradient(0, 0, 320, 240);
            gradient.addColorStop(0, '#4facfe');
            gradient.addColorStop(1, '#00f2fe');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 320, 240);
            
            // æ·»åŠ æ–‡å­—
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('è§†é¢‘ç¼©ç•¥å›¾', 160, 120);
            ctx.font = '14px Arial';
            ctx.fillText('ç¼–è¾‘å™¨ç”Ÿæˆ', 160, 150);
            
            const thumbnailDataUrl = canvas.toDataURL('image/jpeg', 0.8);
            
            // æ¨¡æ‹Ÿç¼–è¾‘å™¨æ•°æ®ç»“æ„
            window.mockEditedVideo = {
                videoUrl: 'blob:http://localhost:5173/mock-video-url',
                duration: 30,
                cover: {
                    type: 'frame',
                    frameTime: 1,
                    preview: thumbnailDataUrl
                },
                hasEdits: true,
                editedAt: new Date().toISOString()
            };
            
            resultDiv.innerHTML = `
                <div class="success test-result">
                    âœ… ç¼–è¾‘å™¨ç¼©ç•¥å›¾ç”ŸæˆæˆåŠŸ<br>
                    ğŸ“ å°ºå¯¸: 320x240<br>
                    ğŸ“¦ å¤§å°: ${Math.round(thumbnailDataUrl.length / 1024)} KB<br>
                    ğŸ¯ ç±»å‹: ${thumbnailDataUrl.substring(0, 30)}...
                </div>
                <img src="${thumbnailDataUrl}" class="thumbnail-preview" alt="ç”Ÿæˆçš„ç¼©ç•¥å›¾">
            `;
        }

        // æ¨¡æ‹Ÿè§†é¢‘å‘å¸ƒæµç¨‹
        function simulateVideoPublish() {
            const resultDiv = document.getElementById('publish-result');
            
            if (!window.mockEditedVideo) {
                resultDiv.innerHTML = '<div class="error test-result">âŒ è¯·å…ˆç”Ÿæˆæ¨¡æ‹Ÿç¼©ç•¥å›¾</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="info test-result">æ­£åœ¨æ¨¡æ‹Ÿå‘å¸ƒæµç¨‹...</div>';
            
            // æ¨¡æ‹Ÿå‘å¸ƒæ•°æ®
            const publishData = {
                userId: 'user_demo_001',
                title: 'æµ‹è¯•è§†é¢‘ - ç¼©ç•¥å›¾ä¿®å¤',
                description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è§†é¢‘ï¼Œç”¨äºéªŒè¯ç¼©ç•¥å›¾ä¿®å¤åŠŸèƒ½',
                videoUrl: window.mockEditedVideo.videoUrl,
                duration: window.mockEditedVideo.duration,
                editedVideo: window.mockEditedVideo
            };
            
            // æ¨¡æ‹Ÿç¼©ç•¥å›¾å¤„ç†é€»è¾‘
            let thumbnailUrl = null;
            if (publishData.editedVideo && publishData.editedVideo.cover && publishData.editedVideo.cover.preview) {
                thumbnailUrl = publishData.editedVideo.cover.preview;
            }
            
            // æ¨¡æ‹ŸAPIæ•°æ®
            const apiData = {
                user_id: publishData.userId,
                title: publishData.title,
                description: publishData.description,
                category: 'test',
                tags: ['æµ‹è¯•', 'ç¼©ç•¥å›¾'],
                duration: publishData.duration,
                video_url: publishData.videoUrl,
                thumbnail_url: thumbnailUrl,
                is_private: false
            };
            
            // ä¿å­˜åˆ°æ¨¡æ‹Ÿæ•°æ®åº“
            window.mockVideoData = {
                id: 'test_video_' + Date.now(),
                ...apiData,
                created_at: new Date().toISOString(),
                view_count: 0,
                like_count: 0,
                comment_count: 0,
                share_count: 0,
                quality_score: 5.0
            };
            
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div class="success test-result">
                        âœ… è§†é¢‘å‘å¸ƒæ¨¡æ‹ŸæˆåŠŸ<br>
                        ğŸ†” è§†é¢‘ID: ${window.mockVideoData.id}<br>
                        ğŸ–¼ï¸ ç¼©ç•¥å›¾å·²ä¿å­˜: ${thumbnailUrl ? 'æ˜¯' : 'å¦'}<br>
                        ğŸ“¦ ç¼©ç•¥å›¾å¤§å°: ${thumbnailUrl ? Math.round(thumbnailUrl.length / 1024) + ' KB' : 'N/A'}
                    </div>
                    <div class="code-block">
APIæ•°æ®ç»“æ„:
${JSON.stringify({
    title: apiData.title,
    thumbnail_url: thumbnailUrl ? '[Base64 Data]' : null,
    video_url: '[Video Data]'
}, null, 2)}
                    </div>
                `;
            }, 1000);
        }

        // æ¨¡æ‹ŸProfileé¡µé¢åŠ è½½
        function simulateProfileLoad() {
            const resultDiv = document.getElementById('profile-result');
            
            if (!window.mockVideoData) {
                resultDiv.innerHTML = '<div class="error test-result">âŒ è¯·å…ˆæ¨¡æ‹Ÿè§†é¢‘å‘å¸ƒ</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="info test-result">æ­£åœ¨æ¨¡æ‹ŸProfileé¡µé¢åŠ è½½...</div>';
            
            // æ¨¡æ‹Ÿä»æ•°æ®åº“è·å–è§†é¢‘æ•°æ®
            const videoContent = {
                id: window.mockVideoData.id,
                title: window.mockVideoData.title,
                description: window.mockVideoData.description,
                category: window.mockVideoData.category,
                tags: window.mockVideoData.tags,
                creatorId: window.mockVideoData.user_id,
                duration: window.mockVideoData.duration,
                uploadTime: new Date(window.mockVideoData.created_at).getTime(),
                videoUrl: window.mockVideoData.video_url,
                thumbnailUrl: window.mockVideoData.thumbnail_url,
                stats: {
                    views: window.mockVideoData.view_count,
                    likes: window.mockVideoData.like_count,
                    comments: window.mockVideoData.comment_count,
                    shares: window.mockVideoData.share_count
                },
                qualityScore: window.mockVideoData.quality_score,
                isPrivate: window.mockVideoData.is_private
            };
            
            // æ¨¡æ‹ŸProfileé¡µé¢çš„ç¼©ç•¥å›¾å¤„ç†é€»è¾‘
            let thumbnail = '';
            let thumbnailSource = '';
            
            if (videoContent.thumbnailUrl) {
                thumbnail = videoContent.thumbnailUrl;
                thumbnailSource = 'æ•°æ®åº“ä¸­çš„ç¼©ç•¥å›¾';
            } else {
                thumbnail = 'https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?prompt=video%20placeholder&image_size=portrait_4_3';
                thumbnailSource = 'é™çº§æ–¹æ¡ˆ - AIç”Ÿæˆ';
            }
            
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div class="success test-result">
                        âœ… Profileé¡µé¢åŠ è½½æ¨¡æ‹ŸæˆåŠŸ<br>
                        ğŸ¯ ç¼©ç•¥å›¾æ¥æº: ${thumbnailSource}<br>
                        ğŸ“Š ä¼˜å…ˆçº§: ${videoContent.thumbnailUrl ? '1. æ•°æ®åº“ç¼©ç•¥å›¾ âœ…' : '2. è§†é¢‘ç”Ÿæˆ âŒ â†’ 3. é™çº§æ–¹æ¡ˆ âœ…'}
                    </div>
                    <div class="info test-result">
                        <strong>ç¼©ç•¥å›¾å¤„ç†æµç¨‹ï¼š</strong><br>
                        ${videoContent.thumbnailUrl ? 
                            '1. âœ… æ£€æŸ¥æ•°æ®åº“ä¸­çš„thumbnailUrl - æ‰¾åˆ°<br>2. âœ… ç›´æ¥ä½¿ç”¨æ•°æ®åº“ç¼©ç•¥å›¾' :
                            '1. âŒ æ£€æŸ¥æ•°æ®åº“ä¸­çš„thumbnailUrl - æœªæ‰¾åˆ°<br>2. âŒ å°è¯•ä»è§†é¢‘ç”Ÿæˆç¼©ç•¥å›¾ - å¤±è´¥<br>3. âœ… ä½¿ç”¨é™çº§æ–¹æ¡ˆ'
                        }
                    </div>
                    ${videoContent.thumbnailUrl ? 
                        `<img src="${thumbnail}" class="thumbnail-preview" alt="æ•°æ®åº“ç¼©ç•¥å›¾">` :
                        '<div class="thumbnail-preview" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center;">é™çº§æ–¹æ¡ˆç¼©ç•¥å›¾</div>'
                    }
                `;
            }, 1000);
        }

        // è¿è¡Œå®Œæ•´æµ‹è¯•
        function runFullTest() {
            const resultDiv = document.getElementById('full-test-result');
            resultDiv.innerHTML = '<div class="info test-result">æ­£åœ¨è¿è¡Œå®Œæ•´æµ‹è¯•æµç¨‹...</div>';
            
            let step = 1;
            const updateProgress = (message) => {
                resultDiv.innerHTML += `<div class="info test-result">æ­¥éª¤ ${step++}: ${message}</div>`;
            };
            
            // æ­¥éª¤1: ç”Ÿæˆç¼©ç•¥å›¾
            setTimeout(() => {
                updateProgress('ç”Ÿæˆç¼–è¾‘å™¨ç¼©ç•¥å›¾...');
                simulateEditorThumbnail();
            }, 500);
            
            // æ­¥éª¤2: å‘å¸ƒè§†é¢‘
            setTimeout(() => {
                updateProgress('å‘å¸ƒè§†é¢‘å¹¶ä¿å­˜ç¼©ç•¥å›¾...');
                simulateVideoPublish();
            }, 1500);
            
            // æ­¥éª¤3: ProfileåŠ è½½
            setTimeout(() => {
                updateProgress('Profileé¡µé¢åŠ è½½å¹¶æ˜¾ç¤ºç¼©ç•¥å›¾...');
                simulateProfileLoad();
            }, 3000);
            
            // æ­¥éª¤4: æ€»ç»“
            setTimeout(() => {
                const hasThumb = window.mockVideoData && window.mockVideoData.thumbnail_url;
                resultDiv.innerHTML += `
                    <div class="${hasThumb ? 'success' : 'error'} test-result">
                        <strong>ğŸ¯ å®Œæ•´æµ‹è¯•ç»“æœ:</strong><br>
                        ${hasThumb ? 
                            'âœ… ç¼©ç•¥å›¾ä¿®å¤åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼<br>âœ… ç¼–è¾‘å™¨ç”Ÿæˆçš„ç¼©ç•¥å›¾æˆåŠŸä¿å­˜åˆ°æ•°æ®åº“<br>âœ… Profileé¡µé¢ä¼˜å…ˆä½¿ç”¨æ•°æ®åº“ç¼©ç•¥å›¾<br>âœ… ä¸å†å‡ºç°ç¼©ç•¥å›¾ç”Ÿæˆå¤±è´¥çš„é”™è¯¯' :
                            'âŒ ç¼©ç•¥å›¾ä¿®å¤åŠŸèƒ½å­˜åœ¨é—®é¢˜<br>âŒ ç¼©ç•¥å›¾æœªèƒ½æ­£ç¡®ä¿å­˜æˆ–ä¼ é€’'
                        }
                    </div>
                `;
            }, 4500);
        }
    </script>
</body>
</html>